<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NAHVG Kontakte</title>
<link rel="apple-touch-icon" href="logo.png">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="icon" type="image/png" href="logo.png">
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<style>
:root{--nahvg-blue:#00549f;--nahvg-light-blue:#e6f0f8;--nahvg-gray:#f4f4f4;--nahvg-yellow:#ffcc00;--text-dark:#333;--white:#fff;--danger:#c00}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--nahvg-gray);margin:0;padding:0;color:var(--text-dark);display:flex;flex-direction:column;min-height:100vh}header{background-color:var(--nahvg-blue);color:var(--white);padding:1.5rem 1rem;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.1)}header h1{margin:0;font-size:1.5rem}.container{max-width:1200px;margin:20px auto;padding:0 15px;flex:1}.filter-section{background:var(--white);padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 4px rgba(0,0,0,.05);display:flex;flex-direction:column;align-items:center;gap:15px}.filter-controls{display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}select{padding:8px 15px;border-radius:4px;border:1px solid #ccc;font-size:1rem;min-width:200px}.upload-section{text-align:center;margin-bottom:20px;padding:20px;background:var(--white);border-radius:8px;display:none}#status-message{text-align:center;padding:10px;color:#666}.contact-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-bottom:40px}.card{background:var(--white);border-radius:8px;border-left:5px solid var(--nahvg-blue);padding:20px;box-shadow:0 4px 6px rgba(0,0,0,.05)}.card h3{margin:0 0 5px 0;color:var(--nahvg-blue)}.card .position{font-size:.9rem;font-weight:700;color:#444}.card .bereich{font-size:.85rem;color:#777;margin-bottom:10px;font-style:italic}.card .info{font-size:.85rem;margin-bottom:5px}.card .tag{display:inline-block;background:var(--nahvg-light-blue);color:var(--nahvg-blue);padding:2px 8px;border-radius:4px;font-size:.75rem;margin-top:10px}.actions{display:flex;gap:10px;margin-top:15px}.btn{flex:1;padding:10px;border:none;border-radius:4px;cursor:pointer;font-weight:700;display:flex;align-items:center;justify-content:center;text-decoration:none;font-size:.9rem}.btn-call{background-color:var(--nahvg-blue);color:#fff}.btn-mail{background-color:#f0f0f0;color:var(--nahvg-blue);border:1px solid var(--nahvg-blue)}.btn-bulk-mail{background-color:var(--nahvg-yellow);color:var(--nahvg-blue);padding:10px 25px;border:1px solid #e6b800}.btn-reset{background-color:transparent;color:var(--danger);border:1px solid var(--danger);margin-top:10px;font-size:.7rem;padding:5px 10px}footer{text-align:center;padding:20px;font-size:.8rem;color:#777;background:#eee;border-top:1px solid #ddd}.copy-toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 20px;border-radius:20px;display:none;z-index:1000}
</style>
</head>
<body>
<header><h1>NAHVG Kontakte</h1></header>
<div class="container">
<div id="u-ui" class="upload-section">
<p>Keine lokalen Daten gefunden. Bitte Excel-Datei wählen:</p>
<input type="file" id="f-in" accept=".xlsx, .xls">
</div>
<div id="f-co" class="filter-section" style="display:none">
<div class="filter-controls">
<label for="b-fi">Filter nach Bereich:</label>
<select id="b-fi"><option value="all">Alle Bereiche</option></select>
</div>
<div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
<button id="b-ma" class="btn btn-bulk-mail">Sammel-E-Mail</button>
<button id="r-db" class="btn btn-reset">Datei neu laden / Cache leeren</button>
</div>
</div>
<div id="s-ms">Prüfe lokale Datenbank...</div>
<div id="c-gr" class="contact-grid"></div>
</div>
<footer>Entwickler: Marcus Hörnemann | Version: 1.2.3</footer>
<div id="toast" class="copy-toast">E-Mail kopiert!</div>
<script>
let _ac=[],_cf=[];const _D='NahvgDB',_S='excel_store',_EF='nahvg_kontakte.xlsx';function _oD(){return new Promise((r,j)=>{const q=indexedDB.open(_D,1);q.onupgradeneeded=e=>e.target.result.createObjectStore(_S);q.onsuccess=e=>r(e.target.result);q.onerror=e=>j(e.target.error)})}async function _sD(d){const b=await _oD(),t=b.transaction(_S,'readwrite');t.objectStore(_S).put(d,'latest_excel');return t.complete}async function _lD(){const b=await _oD();return new Promise(r=>{const t=b.transaction(_S,'readonly'),q=t.objectStore(_S).get('latest_excel');q.onsuccess=()=>r(q.result);q.onerror=()=>r(null)})}async function _cD(){const b=await _oD(),t=b.transaction(_S,'readwrite');t.objectStore(_S).delete('latest_excel');location.reload()}async function _init(){const c=await _lD();if(c){_pX(c,0);return}try{const r=await fetch(_EF);if(!r.ok)throw new Error();const d=await r.arrayBuffer();_pX(d,1)}catch(e){document.getElementById('s-ms').innerText="";document.getElementById('u-ui').style.display='block'}}document.getElementById('f-in').onchange=e=>{const r=new FileReader();r.onload=v=>_pX(v.target.result,1);r.readAsArrayBuffer(e.target.files[0])};document.getElementById('r-db').onclick=_cD;function _pX(b,s){try{const w=XLSX.read(new Uint8Array(b),{type:'array'});_ac=XLSX.utils.sheet_to_json(w.Sheets[w.SheetNames[0]]);_cf=_ac;if(s)_sD(b);_sf(_ac);_rc(_ac);document.getElementById('u-ui').style.display='none';document.getElementById('s-ms').style.display='none';document.getElementById('f-co').style.display='flex'}catch(e){alert("Fehler.");console.error(e)}}function _sf(c){const l=document.getElementById('b-fi'),b=[...new Set(c.map(x=>x.Bereich).filter(y=>y))];l.innerHTML='<option value="all">Alle Bereiche</option>';b.sort().forEach(x=>{const o=document.createElement('option');o.value=o.textContent=x;l.appendChild(o)});l.onchange=e=>{_cf=e.target.value==='all'?_ac:_ac.filter(x=>x.Bereich===e.target.value);_rc(_cf)};document.getElementById('b-ma').onclick=_bm}function _rc(c){const g=document.getElementById('c-gr');g.innerHTML='';c.forEach(x=>{const k=document.createElement('div');k.className='card';const m=x.Email||x['E-Mail']||'',p=x.Mobil||x.Telefon||'';k.innerHTML=`<h3>${x.Vorname||''} ${x.Name||''}</h3><div class="position">${x.Position||''}</div><div class="bereich">${x.Bereich||''}</div><div class="info"><strong>Tel:</strong> ${x.Telefon||'-'}</div><div class="info"><strong>Mobil:</strong> ${x.Mobil||'-'}</div><div class="info"><strong>E-Mail:</strong> ${m||'-'}</div><div class="tag">${x['Ansprechpartner für']||''}</div><div class="actions">${p?`<a href="tel:${p}" class="btn btn-call">Anrufen</a>`:''}<button class="btn btn-mail" onclick="_hM('${m}')">E-Mail</button></div>`;g.appendChild(k)});const n=document.getElementById('b-ma'),v=_cf.filter(x=>x.Email||x['E-Mail']).length;n.textContent=`Sammel-E-Mail (${v})`;n.style.display=v>0?'block':'none'}function _bm(){const e=_cf.map(x=>x.Email||x['E-Mail']).filter(y=>y&&y!=='undefined');if(e.length)window.location.href=`mailto:?bcc=${e.join(',')}`}function _hM(e){if(!e||e==='undefined')return;if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){window.location.href=`mailto:${e}`}else{navigator.clipboard.writeText(e).then(()=>{const t=document.getElementById('toast');t.style.display='block';setTimeout(()=>t.style.display='none',2000)})}}window.onload=_init;
</script>
</body>
</html>
